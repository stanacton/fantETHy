var app=angular.module("fantethy",["ngRoute"]);app.controller("GameCreateCtrl",["$scope","GameSvc",function(a,b){a.item={},a.create=function(c){a.errors=[],c.name||a.errors.push({message:"Name is required."}),c.nickname||a.errors.push({message:"Nickname is required."}),c.leagueSize||a.errors.push({message:"League Size is required."}),c.buyIn||a.errors.push({message:"Buy In is required."}),a.errors.length>0||b.createGame(c,function(b,c){console.log(b,c),b&&a.errors.push(b),c&&("success"===c.status?(console.log("SUCCESS",b,c),a.success=!0,a.address=c.address,a.$apply()):a.errors.push(c.error))})}}]),app.controller("GameCtrl",["$scope","GameSvc","$routeParams",function(a,b,c){a.game=b.getGame(c.id)}]),app.controller("GamesListCtrl",["$scope",function(a){a.games=[{buyIn:3,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #1"},{buyIn:10,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #2"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #3"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Pinky's Game #3"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"The Brain's Game #3"}],a.join=function(a){var b="#/games/"+a.address;window.location.href=b}}]),app.controller("HomeCtrl",["$scope","AngWeb3",function(a,b){}]),app.controller("JoinGameCtrl",["$scope","GameSvc","$routeParams",function(a,b,c){a.game=b.getGame(c.id),a.joinGame=function(d){if(d.nickname||a.errors.push({message:"Nickname is required."}),!(a.errors.length>0)){var e=b.joinGame(c.id,d);"success"===e.status?window.location.href="#/game/"+c.id:a.errors.push({message:"There was an error joining the game."})}}}]),app.controller("MyGamesCtrl",["$scope",function(a){a.games=[{rank:10,buyIn:33,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #1",status:"DRAFT"},{rank:3,buyIn:1,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"The Brain's Game #3",status:"Session In Progress"}]}]),app.controller("SelectTeamCtrl",["$scope","$routeParams","PlayersSvc",function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b.name)return void console.log("Already added.")}a.push(b)}a.max={maxForwards:2,maxMidField:4,maxDefender:4,maxGoalkeeper:1},a.team={forwards:[],midfield:[],defender:[],goalkeeper:[]},c.getPlayers().success(function(b){a.players=b}),a.addForward=function(b){a.team.forwards.length<a.max.maxForwards&&d(a.team.forwards,b)},a.addKeeper=function(b){a.team.goalkeeper.length<a.max.maxGoalkeeper&&d(a.team.goalkeeper,b)},a.addMidfield=function(b){a.team.midfield.length<a.max.maxMidField&&d(a.team.midfield,b)},a.addDefender=function(b){a.team.defender.length<a.max.maxDefender&&d(a.team.defender,b)},a.moveUp=function(b,c){var d=a.team[b].indexOf(c);if(console.log("index",d),d>0){a.team[b].splice(d,1);var e=d-1;a.team[b].splice(e,0,c)}},a.moveDown=function(b,c){var d=a.team[b].indexOf(c);if(console.log("index",d),d<a.team[b].length){a.team[b].splice(d,1);var e=d+1;a.team[b].splice(e,0,c)}},a.remove=function(b,c){var d=a.team[b].indexOf(c);d<a.team[b].length&&a.team[b].splice(d,1)},a.save=function(){if(a.errors=[],a.team.goalkeeper.length!==a.max.maxGoalkeeper&&a.errors.push({message:"You require "+a.max.maxGoalkeeper+" goal keepers."}),a.team.forwards.length!==a.max.maxForwards&&a.errors.push({message:"You require "+a.max.maxForwards+" forwards."}),a.team.midfield.length!==a.max.maxMidField&&a.errors.push({message:"You require "+a.max.maxMidField+" midfielders."}),a.team.defender.length!==a.max.maxDefender&&a.errors.push({message:"You require "+a.max.maxDefender+" defenders."}),!(a.errors.length>0)){var d=b.id,e=a.team;e.leagueAddress=d;var f=c.savePlayers(e);"success"===f.status?window.location.href="#/game/"+d:a.errors.push({message:"There was an error. "+f.error.message})}}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/home",{templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/games",{templateUrl:"partials/games-list.html",controller:"GamesListCtrl"}).when("/my-games",{templateUrl:"partials/games-mine.html",controller:"MyGamesCtrl"}).when("/game/create",{templateUrl:"partials/game-create.html",controller:"GameCreateCtrl"}).when("/game/:id/join",{templateUrl:"partials/game-join.html",controller:"JoinGameCtrl"}).when("/game/:id/select-team",{templateUrl:"partials/select-team.html",controller:"SelectTeamCtrl"}).when("/game/:id",{templateUrl:"partials/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/home"})}]),function(a,b){b.factory("AngWeb3",["WalletBar",function(b){var c=new a,d=b.getHook("edgeware");return console.log("Hook",d),d?c.setProvider(b.getHook("edgware")):c=new a("undefined"!=typeof c?c.currentProvider:new a.providers.HttpProvider("http://localhost:8545")),c}])}(Web3,app),app.factory("GameSvc",["AngWeb3","WalletBar","$http",function(a,b,c){function d(a){var b=(f.at(a),[{name:"Ronaldo"},{name:"Andre Gray"}]),c={address:"0xda3323f2332f32f32f23f32f",buyIn:4,weeksRemaining:4,name:"Andy's Premiership",status:"Season in Progress",prizePool:34,users:[{rank:3,name:"Andy",points:345,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:4,name:"Chris",points:245,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:2,name:"Coleman",points:45,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:1,name:"Acton",points:5,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b}]};return c}function e(a,c){var d=b.getCurrentAccount();return d?(b.createSecureSigner(),void f.new(a.name,a.buyIn,{from:d,data:"606060405273e5483c010d0f50ac93a341ef5428244c84043b54600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506040516108c43803806108c4833981016040528080518201919060200180519060200190919050505b6100746102e1565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561010d57610002565b600f60026000506000016000508190555060026002600050600101600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd60046000506000016000508190555060026004600050600101600050819055506007600f600050600001600050819055506007600f600050600101600050819055506006600f600050600201600050819055506005600f60005060030160005081905550600f600050600460005060020160005060008201600050548160000160005055600182016000505481600101600050556002820160005054816002016000505560038201600050548160030160005055905050600360046000506006016000508190555060056004600050600701600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600801600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb6004600050600901600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600a016000508190555080601d60005081905550611388601e600050819055505b5b5050610508806103bc6000396000f35b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015090506103b9565b905660606040526000357c0100000000000000000000000000000000000000000000000000000000900480634e69d560146100685780637b5330a714610090578063bdce3701146100ce578063c99fea94146100e2578063e0d65ec51461010c57610063565b610002565b346100025761007a6004805050610120565b6040518082815260200191505060405180910390f35b34610002576100a260048050506101de565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34610002576100e060048050506102b9565b005b34610002576100f4600480505061035e565b60405180821515815260200191505060405180910390f35b346100025761011e6004805050610463565b005b600061012a6101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015015156101c357610002565b600060149054906101000a900460ff1690506101da565b5b90565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015090506102b6565b90565b6102c16101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561035a57610002565b5b5b565b60006103686101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561040157610002565b60011515600160005060003373ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005060980160009054906101000a900460ff1615151415610456576000905061045f565b6001905061045f565b5b90565b61046b6101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561050457610002565b5b5b56",gas:47e5},function(a,b){return a?c({status:"error",error:a}):"undefined"!=typeof b.address?c(null,{status:"success",address:b.address}):c({status:"success",error:{message:"The contract address was undefined"}})})):alert("You must log in to transact")}var f=a.eth.contract([{constant:!1,inputs:[],name:"getStatus",outputs:[{name:"",type:"uint8"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"getEntitlement",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[],name:"startDraft",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[],name:"joinLeague",outputs:[{name:"",type:"bool"}],payable:!1,type:"function"},{constant:!1,inputs:[],name:"onUpdate",outputs:[],payable:!1,type:"function"},{inputs:[{name:"name",type:"string"},{name:"setBuyIn",type:"uint256"}],type:"constructor"}]);return{getGame:d,createGame:e}}]),app.factory("PlayersSvc",["$http",function(a){function b(){return a.get("javascripts/data/players.json")}function c(a){return{status:"success"}}return{getPlayers:b,savePlayers:c}}]),app.factory("WalletBar",[function(){var a="com-addc-fantethy-dev-edgware",b="http://localhost:63342",c=new WalletBar({dappNamespace:a,authServiceCallbackUrl:b});return console.log(JSON.stringify(c,null,4)),c}]);