var app=angular.module("fantethy",["ngRoute"]);app.controller("GameCreateCtrl",["$scope","GameSvc",function(a,b){a.item={},a.create=function(c){a.errors=[],c.name||a.errors.push({message:"Name is required."}),c.nickname||a.errors.push({message:"Nickname is required."}),c.leagueSize||a.errors.push({message:"League Size is required."}),c.buyIn||a.errors.push({message:"Buy In is required."}),a.errors.length>0||b.createGame(c,function(b,c){console.log(b,c),b&&a.errors.push(b),c&&("success"===c.status?(console.log("SUCCESS",b,c),a.success=!0,a.address=c.address,a.$apply()):a.errors.push(c.error))})}}]),app.controller("GameCtrl",["$scope","GameSvc","$routeParams",function(a,b,c){a.game=b.getGame(c.id)}]),app.controller("GamesListCtrl",["$scope",function(a){a.games=[{buyIn:3,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #1"},{buyIn:10,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #2"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #3"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Pinky's Game #3"},{buyIn:15,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"The Brain's Game #3"}],a.join=function(a){var b="#/games/"+a.address;window.location.href=b}}]),app.controller("HomeCtrl",["$scope","AngWeb3",function(a,b){}]),app.controller("JoinGameCtrl",["$scope","GameSvc","$routeParams",function(a,b,c){a.game=b.getGame(c.id),a.joinGame=function(d){console.log("TRYING TYRIG"),d.nickname||a.errors.push({message:"Nickname is required."}),a.errors.length>0||b.joinLeague(c.id,function(b,d){d&&("success"===d.status?window.location.href="#/game/"+c.id:a.errors.push({message:"There was an error joining the game."}))})}}]),app.controller("MyGamesCtrl",["$scope",function(a){a.games=[{rank:10,buyIn:33,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"Andy's Game #1",status:"DRAFT"},{rank:3,buyIn:1,address:"0x12423596843e32f32af333",type:"WINNER_TAKES_ALL",name:"The Brain's Game #3",status:"Session In Progress"}]}]),app.controller("SelectTeamCtrl",["$scope","$routeParams","PlayersSvc",function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b.name)return void console.log("Already added.")}a.push(b)}a.max={maxForwards:2,maxMidField:4,maxDefender:4,maxGoalkeeper:1},a.team={forwards:[],midfield:[],defender:[],goalkeeper:[]},c.getPlayers().success(function(b){a.players=b}),a.addForward=function(b){a.team.forwards.length<a.max.maxForwards&&d(a.team.forwards,b)},a.addKeeper=function(b){a.team.goalkeeper.length<a.max.maxGoalkeeper&&d(a.team.goalkeeper,b)},a.addMidfield=function(b){a.team.midfield.length<a.max.maxMidField&&d(a.team.midfield,b)},a.addDefender=function(b){a.team.defender.length<a.max.maxDefender&&d(a.team.defender,b)},a.moveUp=function(b,c){var d=a.team[b].indexOf(c);if(console.log("index",d),d>0){a.team[b].splice(d,1);var e=d-1;a.team[b].splice(e,0,c)}},a.moveDown=function(b,c){var d=a.team[b].indexOf(c);if(console.log("index",d),d<a.team[b].length){a.team[b].splice(d,1);var e=d+1;a.team[b].splice(e,0,c)}},a.remove=function(b,c){var d=a.team[b].indexOf(c);d<a.team[b].length&&a.team[b].splice(d,1)},a.save=function(){if(a.errors=[],a.team.goalkeeper.length!==a.max.maxGoalkeeper&&a.errors.push({message:"You require "+a.max.maxGoalkeeper+" goal keepers."}),a.team.forwards.length!==a.max.maxForwards&&a.errors.push({message:"You require "+a.max.maxForwards+" forwards."}),a.team.midfield.length!==a.max.maxMidField&&a.errors.push({message:"You require "+a.max.maxMidField+" midfielders."}),a.team.defender.length!==a.max.maxDefender&&a.errors.push({message:"You require "+a.max.maxDefender+" defenders."}),!(a.errors.length>0)){var d=b.id,e=a.team;e.leagueAddress=d;var f=c.savePlayers(e);"success"===f.status?window.location.href="#/game/"+d:a.errors.push({message:"There was an error. "+f.error.message})}}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/home",{templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/games",{templateUrl:"partials/games-list.html",controller:"GamesListCtrl"}).when("/my-games",{templateUrl:"partials/games-mine.html",controller:"MyGamesCtrl"}).when("/game/create",{templateUrl:"partials/game-create.html",controller:"GameCreateCtrl"}).when("/game/:id/join",{templateUrl:"partials/game-join.html",controller:"JoinGameCtrl"}).when("/game/:id/select-team",{templateUrl:"partials/select-team.html",controller:"SelectTeamCtrl"}).when("/game/:id",{templateUrl:"partials/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/home"})}]),function(a,b){b.factory("AngWeb3",["WalletBar",function(b){var c=new a,d=b.getHook("edgeware");return console.log("Hook",d),d?c.setProvider(b.getHook("edgware")):c=new a("undefined"!=typeof c?c.currentProvider:new a.providers.HttpProvider("http://localhost:8545")),c}])}(Web3,app),app.factory("GameSvc",["AngWeb3","WalletBar","$http",function(a,b,c){function d(a){var b=(g.at(a),[{name:"Ronaldo"},{name:"Andre Gray"}]),c={address:"0xda3323f2332f32f32f23f32f",buyIn:4,weeksRemaining:4,name:"Andy's Premiership",status:"Season in Progress",prizePool:34,users:[{rank:3,name:"Andy",points:345,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:4,name:"Chris",points:245,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:2,name:"Coleman",points:45,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b},{rank:1,name:"Acton",points:5,address:"0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a",players:b}]};return c}function e(a,c){var d=b.getCurrentAccount();return d?(b.createSecureSigner(),void g.new(a.name,a.buyIn,{from:d,data:"606060405273e5483c010d0f50ac93a341ef5428244c84043b54600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555060006020600050556000602160005055604051610901380380610901833981016040528080518201919060200180519060200190919050505b6100846102f1565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561011d57610002565b600f60026000506000016000508190555060026002600050600101600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd60046000506000016000508190555060026004600050600101600050819055506007600f600050600001600050819055506007600f600050600101600050819055506006600f600050600201600050819055506005600f60005060030160005081905550600f600050600460005060020160005060008201600050548160000160005055600182016000505481600101600050556002820160005054816002016000505560038201600050548160030160005055905050600360046000506006016000508190555060056004600050600701600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600801600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb6004600050600901600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600a016000508190555080601d60005081905550611388601e600050819055505b5b5050610535806103cc6000396000f35b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015090506103c9565b905660606040523615610074576000357c0100000000000000000000000000000000000000000000000000000000900480634e69d560146100795780634ec18db9146100a15780637b5330a7146100c95780638caa008314610107578063c99fea941461012f578063e0d65ec51461015957610074565b610002565b346100025761008b600480505061016d565b6040518082815260200191505060405180910390f35b34610002576100b3600480505061022b565b6040518082815260200191505060405180910390f35b34610002576100db6004805050610234565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3461000257610119600480505061030f565b6040518082815260200191505060405180910390f35b34610002576101416004805050610318565b60405180821515815260200191505060405180910390f35b346100025761016b6004805050610490565b005b6000610177610234565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561021057610002565b600060149054906101000a900460ff169050610227565b5b90565b60216000505481565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150905061030c565b90565b60206000505481565b60006000610324610234565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015015156103bd57610002565b601d600050543410156103cf57610002565b6002600050600001600050546020600050541015156103ed57610002565b600160005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000509050338160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550348160980160008282825054019250508190555060016020600050540160206000508190555034602160005054016021600050819055506001915061048b565b5b5090565b610498610234565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561053157610002565b5b5b56",gas:47e5},function(a,b){return a?c({status:"error",error:a}):"undefined"!=typeof b.address?c(null,{status:"success",address:b.address}):c({status:"success",error:{message:"The contract address was undefined"}})})):alert("You must log in to transact")}function f(c,d){var e=b.getCurrentAccount();if(!e)return alert("You must log in to transact");b.createSecureSigner();var f=g.at(c);f.joinLeague.call({from:e,value:a.toWei(4,"ether")},function(a,b){return a?d(a):(console.log(a,b),d(null,{status:"success"}))})}var g=a.eth.contract([{constant:!1,inputs:[],name:"getStatus",outputs:[{name:"",type:"uint8"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"poolSize",outputs:[{name:"",type:"uint256"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"getEntitlement",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"teamCount",outputs:[{name:"",type:"uint256"}],payable:!1,type:"function"},{constant:!1,inputs:[],name:"joinLeague",outputs:[{name:"",type:"bool"}],payable:!1,type:"function"},{constant:!1,inputs:[],name:"onUpdate",outputs:[],payable:!1,type:"function"},{inputs:[{name:"name",type:"string"},{name:"setBuyIn",type:"uint256"}],type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"_from",type:"address"},{indexed:!0,name:"_to",type:"address"},{indexed:!1,name:"_value",type:"uint256"}],name:"Transfer",type:"event"}]);return{getGame:d,createGame:e,joinLeague:f}}]),app.factory("PlayersSvc",["$http",function(a){function b(){return a.get("javascripts/data/players.json")}function c(a){return{status:"success"}}return{getPlayers:b,savePlayers:c}}]),app.factory("WalletBar",[function(){var a="com-addc-fantethy-dev-edgware",b="http://localhost:63342",c=new WalletBar({dappNamespace:a,authServiceCallbackUrl:b});return console.log(JSON.stringify(c,null,4)),c}]);