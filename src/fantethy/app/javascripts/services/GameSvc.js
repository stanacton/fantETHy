app.factory("GameSvc", ['AngWeb3','WalletBar',"$http", function (web3, WalletBar, $http)  {

    var FantasyLeagueContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"getStatus","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getEntitlement","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startDraft","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"joinLeague","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"onUpdate","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"name","type":"string"},{"name":"setBuyIn","type":"uint256"}],"type":"constructor"}]);
    function getGame(id) {
        var league = FantasyLeagueContract.at(id);

        var players = [
            { name: "Ronaldo"},
            { name: "Andre Gray"},
        ];

        var item = {
            address: "0xda3323f2332f32f32f23f32f",
            buyIn: 4,
            weeksRemaining: 4,
            name: "Andy's Premiership",
            status: "Season in Progress",
            prizePool: 34,
            users: [
                { rank: 3, name: "Andy", points: 345, address: "0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a", players: players},
                { rank: 4, name: "Chris",points: 245, address: "0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a", players: players},
                { rank: 2, name: "Coleman",points: 45, address: "0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a", players: players},
                { rank: 1, name: "Acton", points: 5,address: "0x44asa097fad6fdfs9s87f9s7f97a7f7af7e9f7a89a7f9a", players: players}
            ]
        };

        return item;

    }

    function createGame(game, next) {
        var account = WalletBar.getCurrentAccount(); // get account selected in wallet bar
        if (!account) return alert("You must log in to transact");
        WalletBar.createSecureSigner();
        FantasyLeagueContract.new(
            game.name,
            game.buyIn,
            {
                from: account,
                data: '606060405273e5483c010d0f50ac93a341ef5428244c84043b54600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506040516108c43803806108c4833981016040528080518201919060200180519060200190919050505b6100746102e1565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561010d57610002565b600f60026000506000016000508190555060026002600050600101600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffd60046000506000016000508190555060026004600050600101600050819055506007600f600050600001600050819055506007600f600050600101600050819055506006600f600050600201600050819055506005600f60005060030160005081905550600f600050600460005060020160005060008201600050548160000160005055600182016000505481600101600050556002820160005054816002016000505560038201600050548160030160005055905050600360046000506006016000508190555060056004600050600701600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600801600050819055507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb6004600050600901600050819055507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6004600050600a016000508190555080601d60005081905550611388601e600050819055505b5b5050610508806103bc6000396000f35b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015090506103b9565b905660606040526000357c0100000000000000000000000000000000000000000000000000000000900480634e69d560146100685780637b5330a714610090578063bdce3701146100ce578063c99fea94146100e2578063e0d65ec51461010c57610063565b610002565b346100025761007a6004805050610120565b6040518082815260200191505060405180910390f35b34610002576100a260048050506101de565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34610002576100e060048050506102b9565b005b34610002576100f4600480505061035e565b60405180821515815260200191505060405180910390f35b346100025761011e6004805050610463565b005b600061012a6101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015015156101c357610002565b600060149054906101000a900460ff1690506101da565b5b90565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dc5acb90604051817c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260158152602001807f636f6d2e616464632e66616e74657468792e6465760000000000000000000000815260200150602001915050602060405180830381600087803b156100025760325a03f115610002575050506040518051906020015090506102b6565b90565b6102c16101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561035a57610002565b5b5b565b60006103686101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561040157610002565b60011515600160005060003373ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005060980160009054906101000a900460ff1615151415610456576000905061045f565b6001905061045f565b5b90565b61046b6101de565b73ffffffffffffffffffffffffffffffffffffffff16639ce6582d33604051827c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b156100025760325a03f1156100025750505060405180519060200150151561050457610002565b5b5b56',
                gas: 4700000
            }, function (e, contract){
                if (e) {
                    return next({
                        status: "error",
                        error: e
                    });
                }
                if (typeof contract.address !== 'undefined') {
                    return next(null, {
                        status: "success",
                        address: contract.address
                    });
                } else {
                    return next({
                        status: "success",
                        error: { message: "The contract address was undefined" }
                    });
                }
            });

    }

    return  {
        getGame: getGame,
        createGame: createGame
    };
}]);